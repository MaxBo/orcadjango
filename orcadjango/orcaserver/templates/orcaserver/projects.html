{% extends 'orcaserver/base.html' %}
{% load static %}

{% block content %}
<h4> Please select a project <div class="help" style="display: inline;">*</div></h4>
<table class="table table-striped select" id="projects">
  <thead>
    <tr>
      <th style="display: none;">ID</th>
      <th>Name</th>
      <th>Description</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for project in projects %}
    <tr onclick="highlightRow(this)" data-id="{{ project.id }}">
      <td style="display: none;"> {{ project.id }} </td>
      <td> {{ project.name }} </td>
      <td> {{ project.description }} </td>
      <td>
        <a href="/projects/change/{{project.id}}/" title="Edit Project"><i class="fa fa-pencil" style="font-size: 1.5em;"></i></a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<form action='' method="post">
  {% csrf_token %}
  <input name="project" style="display: None;"/>
  <a class="btn btn-success" href="/projects/create/" title="Add a new project" style="margin-right: 0.5em;">
    <i class="fa fa-plus"></i>Add
  </a>
  <button disabled class="btn btn-danger" id="deleteBtn" type="button" title="Remove the selected project" data-toggle="modal" data-target="#confirm-delete-modal">
    <i class="fa fa-trash-o"></i>Remove
  </button>
  <button disabled class="btn btn-primary" type="submit" name="select" value="select" title="Set selected project as active" style="float: right;">
    <i class="fa fa-star-o"></i>Select
  </button>

  <div class="modal fade" id="confirm-delete-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm removal</h5>
        </div>
          <div class="modal-body">
            <p>
              Do you really want to remove the selected project?
            </p>
            <p>
              <i class="fa fa-exclamation-triangle"></i>
              This does only remove the project with its scenarios, parameters and step-configurations. Possible databases or data folders related to the project remain and have to be removed manually or by running suitable steps first, if required.
            </p>
          </div>
        <div class="modal-footer">
          <input class="btn btn-danger" type="submit" name="delete" value="Confirm"/>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</form>
<script>
  var table = document.getElementById('projects'),
      projectInput = document.querySelector('input[name="project"]'),
      selectBtn = document.querySelector('button[name="select"]'),
      deleteBtn = document.getElementById('deleteBtn');
  // highlight row in table on click
  function highlightRow(target){
    for(row of table.rows){
      if (row!=target) row.classList.remove('selected');
    }
    target.classList.toggle('selected');
    var isSelected = target.classList.contains('selected');
    projectInput.value = isSelected ? target.dataset['id'] : null;
    selectBtn.disabled = !isSelected;
    deleteBtn.disabled = !isSelected;
  }
</script>

{% endblock %}